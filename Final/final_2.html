<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Bootstrap core CSS -->
	<link href="../css/bootstrap.min.css" rel="stylesheet">
	<script src="../js/d3.min.js"></script>
	<script src="../js/d3.tip.v0.6.3.js"></script>
	<script src="../js/jquery-1.8.3.min.js"></script>
	<script src="../js/bootstrap-modal.js"></script>
	<link href="../css/my_css.css" rel="stylesheet">
	<!-- <script src="./js/hw_2.js"></script> -->


	<!-- Just for debugging purposes. Don't actually copy this line! -->
	<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->

	<!-- title -->
	<title>Alone All Life</title>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-61822913-1', 'auto');
	  ga('send', 'pageview');

	</script>
</head>



<body>
	<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/zh_CN/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      	<div class="container-fluid">
	        <div class="navbar-header">
	          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	          	<span class="sr-only">Toggle navigation</span>
	          </button>
	          <a class="navbar-brand" style="color:#ffffff;font-weight:900" href="/">All Life - IE590 - Project On Game of Thrones</a>
	        </div>
	        <div class="navbar-collapse collapse">
	          <ul class="nav navbar-nav navbar-right">
	           <li ><a href="./final_1.html"><strong>WorldMap</strong></a></li>
	            <li class="active"><a href="./final_2.html"><strong>SurvivalRate</strong></a></li>
	            <li><a href="./final_3.html"><strong>Ratings</strong></a></li>
	            <li><a href="./final_4.html"><strong>Popularity</strong></a></li>
	          </ul>
	          <div class="navbar-form navbar-right">
	          </div>
	        </div>
    	</div>
	</div>
	<div class="container-fluid">
	  	<div class="row">
	  		<div class="col-sm-3 col-md-3 my_right_side" align="center">
				<div id="left">
					 <!-- <li class="cb" type="checkbox" sid="0" checked>0</li><br/> -->
					<ul>
						 <li class="cb" type="checkbox" id="s17">Afghanistan</li><br/>
						 <li class="cb" type="checkbox" id="s18">Japan</li><br/>
						 <li class="cb" type="checkbox" id="s1" checked>Stark</li><br/>
						 <li class="cb" type="checkbox" id="s2" checked>Baratheon</li><br/>
						 <li class="cb" type="checkbox" id="s3">Targaryen</li><br/>
						 <li class="cb" type="checkbox" id="s4">Lannister</li><br/>
						 <li class="cb" type="checkbox" id="s5">Martell</li><br/>
						 <li class="cb" type="checkbox" id="s6">Tully</li><br/>
						 <!-- <li class="cb" type="checkbox" sid="8">7</li><br/> -->
						 <!-- <li class="cb" type="checkbox" sid="8">8</li><br/> -->
						 <!-- <li class="cb" type="checkbox" sid="9">9</li><br/> -->
						 <li class="cb" type="checkbox" id="s10">Night's Watch</li><br/>
						 <li class="cb" type="checkbox" id="s11">Dothraki</li><br/>
						 <li class="cb" type="checkbox" id="s12">Beyond the wall</li><br/>
						 <li class="cb" type="checkbox" id="s13">The Faith</li><br/>
						 <li class="cb" type="checkbox" id="s14">Greyjoy</li><br/>
						 <li class="cb" type="checkbox" id="s15">Arryn</li><br/>
						 <li class="cb" type="checkbox" id="s16">Tyrell</li><br/>
					</ul>
				</div>
	  		</div>
	  		<div class="col-sm-9 col-md-9 my_right_side" align="center">
	  			<div id="dis_1_right_side"></div>	  			
	  		</div>
	  	</div>
	  	<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main" id="content-loader" align="center">
		    	<div class="fb-comments" data-href="http://alone-all-life.github.io/" data-width="800" data-numposts="5" data-colorscheme="light"></div>
		    	
		    </div>
	  </div>
</body>

<script type="text/javascript">
	var color = d3.scale.category20c()

	var margin = {top: 20, right: 20, bottom: 50, left: 80},
    width = 700 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom

    var tip = d3.tip()
		.attr('class', 'd3-tip')
		.offset([-10, 0])
		.html(function(d, i) {
	    	return "<strong>Age : </strong>" + i + "<br/>"
	    		   +"<strong>Rate : </strong>" + Math.round(d.rate*100)/100
	 	})

    var canvas = d3.select("#dis_1_right_side").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
					.append("g")
					.attr("transform", "translate("+margin.left+", "+margin.top+")")

	canvas.call(tip)
	d3.csv("./final_data/[2]GoT Raw Data(age and death).csv", function(error, data) {
		d3.csv("./final_data/[2]Moderndaycomparison.csv", function(error, aj) {
		var width_scale = d3.scale.linear()
						.domain([0, 100])
						.range([0, width])
		var height_scale = d3.scale.linear()
						.domain([0, 1])
						.range([height, 0])

		var x_axis = d3.svg.axis()
					.scale(width_scale)
					.orient("bottom")

		var y_axis = d3.svg.axis()
					.scale(height_scale)
					.orient("left")


		canvas.append("g")
			.attr("class", "x axis")
			.attr("transform", "translate(0, " + height+")")
			.call(x_axis)



		canvas.append("g")
			.attr("class", "y axis")
			.call(y_axis)
			.append("text")
	    		.attr("transform", "translate(0, "+ (height/2 -60)+") rotate(-90)")
	      		.attr("y", -85)
		      	.style("text-anchor", "end")
		      	.text("US Viewers");

		data = data_process(data, aj)
		var points = new Array()
		var lines = new Array()
		for (var i=1; i<19; i++) {
			points[i] = canvas.selectAll(".pointss"+i)
							.data(data[i])
							.enter().append("circle")
							  .attr("class", "pointss" + i)
							  .attr("cx", function(d,i) {return width_scale(d.idx)})
							  .attr("cy", function(d,i) {return height_scale(d.rate)})
							  .attr("r", function(d,i) {
							  		// if (d.Affiliation>16) return 3
							  		return 0
							  })
							  .style("fill", function(d) {return color(d.Affiliation)})
							  .on("mouseover", tip.show)
							  .on("mouseout", tip.hide)
		}
							  

		for (var i=1; i<19; i++) {
			lines[i] = canvas.selectAll(".liness"+i)
							.data(data[i]).enter()
							.append("line")
							   .attr('class', "liness"+i)
							   .attr("x1", function(d,j) {
							   		if (j == 0) j=1
							   		return width_scale(data[i][j-1].idx)})
							   .attr("y1", function(d,j) {
							   		if (j == 0) j=1
							   		return height_scale(data[i][j-1].rate) })
							   .attr("x2", function(d,j) {return width_scale(data[i][j].idx) })
							   .attr("y2", function(d,j) {return height_scale(data[i][j].rate) })
							   .attr("stroke", function(d,j) {
							   		if (j == 0) j=1
							   		return color(data[i][j-1].Affiliation)})
				    		   .attr("stroke-width", function(d,j) {
							  		if (data[i][j].Affiliation>16) return 2
							  			
							  		return 0
							  	})
		}
	})
	})

	

	d3.selectAll(".cb").on("click", function change() {
		var str = d3.select(this).attr("id")
		var my_lines = d3.selectAll(".lines" + str)
						 .attr("stroke-width", function(d,j) {
						 	if (j == 0) j = 1
						 	var wd = d3.select(this).attr("stroke-width")
						 	if (wd==2) return 0
						 	return 2
						 })


		var my_points = d3.selectAll(".points" + str)
						 .attr("r", function(d,j) {
						 	if (j == 0) j = 1
						 	var wd = d3.select(this).attr("r")
						 	if (wd==3) return 0
						 	return 0
						 })
	})


function data_process(data, aj) {
	var total = new Array()
	var dead = new Array()
	var rate = new Array()
	for (var i=0; i<19; i++) {
		total[i] = 0
		dead[i] = 0
		rate[i] = new Array()
	}
	
	for (var i=0; i<data.length; i++) {
		total[data[i].Affiliation] = total[data[i].Affiliation] + 1
	}

	
		rate[17][0] = {"idx": 0, "rate": 1, "Affiliation":  17}
		rate[18][0] = {"idx": 0, "rate": 1, "Affiliation":  18}

		for (var i=1; i<100; i++) {
			var flag = 0
			rate[17][i] = {"idx": i, "rate": 1, "Affiliation":  17}
			rate[18][i] = {"idx": i, "rate": 1, "Affiliation":  18}
			for (var j=0; j<aj.length; j++) {
				if (i == aj[j].age) {
					rate[17][i].rate = aj[j].Afghanistan2012*1/100
					rate[18][i].rate = aj[j].Japan2012*1/100
					flag = 1
				}
			}
		 	if (flag == 0){
				rate[17][i].rate = rate[17][i-1].rate
				rate[18][i].rate = rate[18][i-1].rate
			}
		}

	var list = [1,2,3,4,5,6,10,11,12,13,14,15,16,17,18]
	for (var i=0; i<list.length; i++) {
		var idx = list[i]
		var id = d3.select("#s"+idx)
					.style("font-size", (total[idx]/2+10)+"px" )
					.style("color", color(i))

	}
			

	for (var i=0; i<100; i++) {
		for (var j=0; j<data.length; j++) {
			if ( data[j].Age == i) {
				dead[data[j].Affiliation] = dead[data[j].Affiliation] + 1
			}
		}

		for (var j=0; j<17; j++) {
			if (total[j] != 0) {
				rate[j][i] = {"idx": i, "rate": (total[j]-dead[j])/total[j], "Affiliation":  j}
			} else {
				rate[j][i] = {"idx": i, "rate": 0, "Affiliation":  j}
			}
		}
	}

	return rate
}
   

</script>
</html>